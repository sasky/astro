---
let { pico8src } = Astro.props;
---
<script>
    // https://docs.astro.build/en/guides/client-side-scripts/#pass-frontmatter-variables-to-scripts
    // passing frontmatter in the js, via a data atribute
    const pico8JSSrc = document.getElementById('body_0')?.getAttribute('data-pico8src');
    // setting a JS Global for the pico8Loader code to find
    // hacky but works
    window.pico8src = pico8JSSrc; 
</script>
<script is:inline src="/pico8/pico8Loader.js" ></script>

<!-- all this is copied from the pico8 html generator, with some changes, so yucky -->
<div style="padding: 0px; margin: 0px; background-color: #222; color: #ccc">
  <div id="body_0" data-pico8src="{pico8src}">
    <div
      id="p8_frame_0"
      style="max-width: 800px; max-height: 800px; margin: auto"
    >
      <div
        id="p8_frame"
        style="
          display: flex;
          width: 100%;
          max-width: 95vw;
          height: 60vw;
          max-height: 95vh;
          margin: auto;
        "
      >
        <div
          id="p8_menu_buttons_touch"
          style="position: absolute; width: 100%; z-index: 10; left: 0px"
        >
          <div
            class="p8_menu_button"
            id="p8b_full"
            style="float: left; margin-left: 10px"
          ></div>
          <div
            class="p8_menu_button"
            id="p8b_sound"
            style="float: left; margin-left: 10px"
          ></div>
          <div
            class="p8_menu_button"
            id="p8b_close"
            style="float: right; margin-right: 10px"
          ></div>
        </div>
        <div id="p8_container" style="margin: auto; display: table">
          <div
            id="p8_start_button"
            class="p8_start_button"
            style="width: 100%; height: 100%; display: flex"
          >
            <img
              width="80"
              height="80"
              style="margin: auto"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAABpklEQVR42u3au23DQBCEYUXOXIGKcujQXUgFuA0XIKgW90Q9oEAg+Ljd27vd2RsCf058gEDqhofPj+OB6SMCAQlIQAIyAhKQgARkBAQDnM6XSRsB7/2e/tSA0//12fCAKsQX3ntDA4oRFwBRIc0AixE38BAhTQGLEAsBUSDNAXcRhYDRIZsAPlp99VECRoXsDpgN0g0wC6Q7IDpkGEBUyG6A0+vKBtkdMBukG2AWSHdAdMgwgKiQ4QDRIMMCokCGB4wOCQPYFVKw2cABNocUjl6wgE0gFashPKAZpHJ2TQNYBVmxW6cDFENWDv9pAUshCVgJScBKSAISkD9hPkT4GkNAMdzepyj8Kye852EBLe51CZHHWQK4JcThD1SlcHPEYY/0a+A0n6SkGZV6w6WZNb3g4Id1b7hwgGhwYQBR4dwB0eHcALPAdQfMBhcOEA0uDCAqnDsgOpwbYBa4poA/31+rZYFrBriFpwGMCtcEcA9PAhgdzhywBK8EEQXOFFCCtwaIBmcGKMWbI6LCmQBq8R6hw5kAMgISkIAEJCAjIAEJSEBGQI9ukV7lRn9nD+gAAAAASUVORK5CYII="
            />
          </div>
          <div
            id="p8_playarea"
            style="
              display: none;
              margin: auto;
              -webkit-user-select: none;
              -moz-user-select: none;
              user-select: none;
              -webkit-touch-callout: none;
            "
          >
            <div
              id="touch_controls_background"
              style="
                pointer-events: none;
                display: none;
                background-color: #000;
                position: fixed;
                top: 0px;
                left: 0px;
                border: 0;
                width: 100vw;
                height: 100vh;
              "
            >
              &nbsp
            </div>

            <div style="display: flex; position: relative">
              <canvas class="emscripten" id="canvas"> </canvas>
              <div
                class="p8_menu_buttons"
                id="p8_menu_buttons"
                style="margin-left: 10px"
              >
                <div
                  class="p8_menu_button"
                  style="position: absolute; bottom: 125px"
                  id="p8b_controls"
                ></div>
                <div
                  class="p8_menu_button"
                  style="position: absolute; bottom: 90px"
                  id="p8b_pause"
                ></div>
                <div
                  class="p8_menu_button"
                  style="position: absolute; bottom: 55px"
                  id="p8b_sound"
                ></div>
                <div
                  class="p8_menu_button"
                  style="position: absolute; bottom: 20px"
                  id="p8b_full"
                ></div>
              </div>
            </div>
            <div
              id="touch_controls_gfx"
              style="
                pointer-events: none;
                display: table;
                position: fixed;
                top: 0px;
                left: 0px;
                border: 0;
                width: 100vw;
                height: 100vh;
              "
            >
              <img
                src=""
                id="controls_right_panel"
                style="position: absolute; opacity: 0.5"
              />
              <img
                src=""
                id="controls_left_panel"
                style="position: absolute; opacity: 0.5"
              />
            </div>
            <textarea
              id="codo_textarea"
              class="emscripten"
              style="
                display: none;
                position: absolute;
                left: -9999px;
                height: 0px;
                overflow: hidden;
              "
            ></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<style>
    .p8_menu_button{
        opacity:0.3;
        padding:4px;
        display:table;
        width:24px;
        height:24px;
        float:right;
    }
    
    @media screen and (min-width:512px) {
        .p8_menu_button{
            width:24px; margin-left:12px; margin-bottom:8px;
        }
    }
    .p8_menu_button:hover{
        opacity:1.0;
        cursor:pointer;
    }
    
    canvas{
        image-rendering: optimizeSpeed;
        image-rendering: -moz-crisp-edges;
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimize-contrast;
        image-rendering: pixelated;
        -ms-interpolation-mode: nearest-neighbor;
        border: 0px;
        cursor: none;
    }
    
    
    .p8_start_button{
        cursor:pointer;
        /* background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAEs0lEQVR4Ae2dP27jRhTGHwV5K0OFgV0X7rWyEKxqyxES38AEvHsENap8AoIncOVGR4iK8AabIJFTSwi8WvUuLAEpDFcRYGwxu0/jIUVxZkjTQ30fDOKZHM2f7/fem9YLfIJKVA0WAAAAQAAAABAAAAAEAAAAAQAAQAAAABAAAAAEAAAAAQAAQMWp7spGr/eCwSrkp3jJ8WAVijH8HhVQoIS/7LKCxCH3HQPALluOAQCrxLcfAwD5lAInu5z113uBW0XgBb6LCKojJysAACAAAAAoF9Ud3ff1XkBEg1WICihNg1UoMAAABAAAAJnJC3yYgAoAAAgAAAAqQ3WH9nq9FxDRYBWKIDHmJwDk775s66YYLahYBpzvHMRjt3g4A2CwCrNUgNyU0IIKuQDi/yqf3JIX+O72zyrIpTsAACAAAAAIAAAAAgAAgAAAACAAAAAIAJxWvWLnufr7WASXP39xYsNe4FfNepYTDKoAQLH+zdmn/z//VhCJ29kRx+3WHQAk537upSD7rsgSQ0Uu4Tdnn4qbPMX9rV93BQD3HJlELlSy+GvDYCdakHE7yu6scSOqAgB6+3HLgOWooNy3Z1CRFvTCave67V43l6kAwMR9JbC5CeoV6z/ReEpE56cflFhbiwuifxJ9V17e/nWDCshbi4tNWZ9SEABAIt855eVY+wb+71n6s65+/zcxNpb7LSjuXUJPOGq37vQa/cEJM5Bz/NL/KTEmIt0lKgiArZ/X9omo+fRoMsnsqH2g3WHM3CciL/D1Nme5XhGXcDSenp9+2HoZZtyzOGP74EQ0IhXAcEL9TsLPlqPCWxC7v97lq8GQ7v7ivvHu8EH3DhAMBN31h36HhpN1/DJ3gGy9Wq2mDPi3lpPQ7IZq+7LL8UDX/TWDXnc+nqof8vDd8A5IaIj6pcc4lcCyntjleKB3xtbdpoQrQjX7FmzmvtanlN6y9Wv6mE0MxF/5AG5nR3Ffoh9VyYG9+2YM5Bxnozmw6T+vsQK4//Cl9Ox20s2yXld5Gkh43Xx6TO88BkWgJ/0+nBUAV6KxRynZ3e51o/FUzDyv7RsswV4nWqyUgplskiy3CkiwZjih4US3saYcz/ici/vG4r6RaLF4KTAYNnSL1M6oevah0Xi6tqnfsamAZ0QFyH7HwKb4eIYhfH93+GB7ByxH9PZjcZA07gDL5Tea2+8Y4IxPy47LGLYsbX9G6xLJBiCnSuQbJRpPc1xFTKskPj9t3U/ZWx62eIGfadwffx4nvv/1ly8Gq0bz9wlN3/o80fx98+kxU9mZ7bn5ddO/L3EHFKv8ikz2qP1ajlfcHWCk8+ZXWo6i8ZSWo+/BriprBXCrEaWXVwG6pSK6UNY7AKpUC4IAAAAgAAAACAAAAAAgANhh1UtZNXxoEVHQmImA46AxkweI95vGxydMn0e856f8PnHOygKQDUo5tmwix4q/yni2MuP7rWMq24LChxYfeNPJdR3JMk9KXEr6lwMgaMy0KsBs2vg8KeuWWAHltCClw8R7vRyzO9mRJI5XLNadsyB5gV/uBnZd5dwBEAAAAAQAAAABAAAAAAQAAAABAABAAAAAEAAAAAQAAAABAABAAAAAUNH6BskoRFboUA7sAAAAEHRFWHRMb2RlUE5HADIwMTEwMjIx41m2wQAAAABJRU5ErkJggg=="); */
        -repeat center;
        -webkit-background-size:cover; -moz-background-size:cover; -o-background-size:cover; background-size:cover;
    }
    
    .button_gfx{
        stroke-width:2;
        stroke: #ffffff;
        stroke-opacity:0.4;
        fill-opacity:0.2;
        fill:black;
    }
    
    .button_gfx_icon{
        stroke-width:3;
        stroke: #909090;
        stroke-opacity:0.7;
        fill:none;
    }
    
</style>